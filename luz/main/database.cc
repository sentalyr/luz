#include "database.hh"
#include <array>

namespace luz::database
{
namespace
{
/// A lookup table mapping the hold position on the 12x12 decoy board to the pixel index.
/// Decoy holds are indexed in a snaking pattern starting from the bottom left, e.g.:
/// [ 2 3 8 ]
/// [ 1 4 7 ]
/// [ 0 5 6 ]
constexpr std::array<int16_t, num_positions> lookup{
  0,   3,   -1,  7,   10,  11,  14,  15,  18,  21,  -1,  -1,  27,  30,  33,  34,  37,  38,  -1,
  -1,  -1,  -1,  29,  26,  -1,  23,  20,  17,  -1,  -1,  -1,  8,   -1,  4,   -1,  1,   2,   5,
  6,   9,   12,  13,  16,  19,  22,  24,  25,  28,  31,  32,  35,  36,  39,  -1,  -1,  -1,  48,
  52,  -1,  58,  62,  -1,  69,  70,  -1,  -1,  -1,  -1,  -1,  84,  85,  83,  82,  79,  78,  75,
  74,  71,  66,  63,  59,  57,  53,  51,  47,  44,  43,  40,  -1,  -1,  -1,  49,  -1,  55,  -1,
  61,  65,  68,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  87,  86,  81,  80,  77,  76,  73,  72,  67,
  64,  60,  56,  54,  50,  46,  45,  42,  41,  -1,  142, 138, 134, 130, 126, 122, 118, 114, 110,
  106, -1,  100, 96,  -1,  -1,  -1,  88,  91,  92,  95,  97,  101, 105, 109, 113, 117, 121, 125,
  129, 133, 137, 141, 143, 144, -1,  -1,  139, 135, 131, 127, 123, 119, 115, 111, 107, 103, 99,
  -1,  -1,  -1,  -1,  89,  90,  93,  94,  98,  102, 104, 108, 112, 116, 120, 124, 128, 132, 136,
  140, 150, 145, -1,  151, 156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, -1,  -1,  -1,
  -1,  207, 206, 202, 201, 197, 195, 191, 187, 183, 179, 175, 171, 167, 163, 159, 155, 149, 146,
  148, 152, 157, 161, 165, 169, 173, 177, 181, 185, 189, 193, -1,  199, -1,  204, -1,  208, 205,
  203, 200, 198, 194, 190, 186, 182, 178, 174, 170, 166, 162, 158, 154, 153, 147, -1,  263, 258,
  254, 250, 246, 242, 238, 234, 230, 225, 221, -1,  -1,  -1,  -1,  -1,  209, 212, 213, 216, 217,
  220, 224, 228, 231, 235, 239, 243, 247, 251, 255, 259, 264, 265, -1,  262, 257, 253, 249, 245,
  241, 237, 233, 229, 226, 222, -1,  -1,  -1,  -1,  -1,  210, 211, 214, 215, 218, 219, 223, 227,
  232, 236, 240, 244, 248, 252, 256, 260, 261, 266, 267, 272, 276, 280, 284, 288, 292, 296, 300,
  304, 308, 312, -1,  319, -1,  326, -1,  327, 324, 325, 320, 318, 315, 311, 307, 303, 299, 295,
  291, 287, 283, 279, 275, 271, 268, -1,  273, 277, 281, 285, 289, 293, 297, 301, 305, 309, 313,
  316, -1,  -1,  -1,  -1,  328, 323, 322, 321, 317, 314, 310, 306, 302, 298, 294, 290, 286, 282,
  278, 274, 270, 269, -1,  -1,  380, 376, 372, 368, 364, 360, 356, 352, 348, 344, 340, -1,  -1,
  -1,  -1,  329, 332, 333, 336, 339, 343, 345, 349, 353, 357, 361, 365, 369, 373, 377, 381, 385,
  386, -1,  383, 379, 375, 371, 367, 363, 359, 355, 351, 347, -1,  341, 337, -1,  -1,  -1,  330,
  331, 334, 335, 338, 342, 346, 350, 354, 358, 362, 366, 370, 374, 378, 382, 384, 387, -1,  -1,
  -1,  396, -1,  403, -1,  410, 414, 418, -1,  -1,  -1,  -1,  -1,  -1,  -1,  434, 433, 430, 429,
  426, 425, 422, 419, 415, 413, 409, 406, 402, 399, 395, 392, 391, 388, -1,  -1,  -1,  397, 400,
  404, 407, 411, -1,  417, 421, -1,  -1,  -1,  -1,  -1,  435, 436, 432, 431, 428, 427, 424, 423,
  420, 416, 412, 408, 405, 401, 398, 394, 393, 390, 389, -1,  -1,  -1,  -1,  455, 453, -1,  451,
  449, 447, -1,  -1,  -1,  442, -1,  439, -1,  437, 438, -1,  441, 443, 444, 445, 446, 448, 450,
  -1,  -1,  454, 456, 456, 458, 459, 460
};
} // anonymous namespace

bool placement_to_pixel(uint16_t position, uint16_t& pixel) noexcept
{
  if (position >= lookup.size())
  {
    return false;
  }

  int16_t pxl = lookup.at(position);
  if (pxl < 0)
  {
    return false;
  }

  pixel = pxl;
  return true;
}
} // namespace luz::database
